# Unified Theme Switcher with Neovim Integration

## Overview

Build a comprehensive theme switching system that integrates Neovim colorschemes with your existing Arch Linux dotfiles setup. The system will allow switching between 7-8 curated themes that apply consistently across Neovim, Kitty, Waybar, Mako, Starship, Hyprland, and other components via a single Waybar button.

## Theme List

1. **Dark Green** - Everforest
2. **Reddish/Orange** - Ashen
3. **Blue/Azure** - Iceberg + Nord (both available)
4. **Cyberpunk** - Neon
5. **Soft Light** - Catppuccin Latte
6. **Purple** - Lavender
7. **Grey/Monochrome** - Lackluster

## Architecture

### Current State
- Theme switcher: `/home/curator/.dotfiles/bin/.bin/theme-switcher.sh`
- Themes directory: `/home/curator/.dotfiles/themes/<theme-name>/`
- Each theme has: `theme.json`, `waybar.css`, `kitty.conf`, `mako.conf`, `starship.toml`, `hyprland.conf`, `hyprlock.conf`
- Neovim uses lazy.nvim, currently has catppuccin hardcoded in `lua/config/lazy.lua`

### Proposed Changes

**Neovim Side:**
1. Install all colorscheme plugins via lazy.nvim
2. Create dynamic colorscheme loader that reads from config file
3. Config file updated by theme-switcher.sh

**Theme Switcher Side:**
1. Add function to update Neovim colorscheme config
2. Extract color palettes from each theme (manual + script-assisted)
3. Store palettes in theme.json
4. User manually creates configs using those palettes

## Implementation Plan

### Phase 1: Setup Neovim Colorscheme Infrastructure

#### 1.1 Create New Colorschemes Plugin File

**File:** `/home/curator/.dotfiles/nvim/.config/nvim/lua/plugins/colorschemes.lua`

Replace the existing `catppuccin.lua` with a unified file containing all 7-8 colorscheme plugins:

```lua
-- All colorscheme plugins for theme switcher
return {
    -- Catppuccin (Latte for light theme)
    {
        "catppuccin/nvim",
        name = "catppuccin",
        priority = 1000,
        config = function()
            require("catppuccin").setup({
                transparent_background = true,
                flavour = "auto", -- latte, frappe, macchiato, mocha
            })
        end,
    },

    -- Everforest (Dark Green)
    {
        "sainnhe/everforest",
        priority = 1000,
        config = function()
            vim.g.everforest_background = "hard" -- 'hard', 'medium', 'soft'
            vim.g.everforest_transparent_background = 1
        end,
    },

    -- Ashen (Reddish/Orange)
    {
        "ficcdaf/ashen.nvim",
        priority = 1000,
    },

    -- Iceberg (Blue/Azure)
    {
        "cocopon/iceberg.vim",
        priority = 1000,
    },

    -- Nord (Blue/Azure alternative)
    {
        "shaunsingh/nord.nvim",
        priority = 1000,
        config = function()
            vim.g.nord_transparent = true
        end,
    },

    -- Neon (Cyberpunk)
    {
        "rafamadriz/neon",
        priority = 1000,
        config = function()
            vim.g.neon_style = "dark"
            vim.g.neon_transparent = true
        end,
    },

    -- Lavender (Purple)
    {
        "joshuadanpeterson/lavender.nvim",
        priority = 1000,
    },

    -- Lackluster (Grey/Monochrome)
    {
        "slugbyte/lackluster.nvim",
        priority = 1000,
    },
}
```

#### 1.2 Create Dynamic Colorscheme Config File

**File:** `/home/curator/.dotfiles/nvim/.config/nvim/lua/config/colorscheme.lua`

This file will be auto-generated by theme-switcher.sh:

```lua
-- Auto-generated by theme-switcher.sh
-- DO NOT EDIT MANUALLY - changes will be overwritten
return {
    colorscheme = "catppuccin-frappe",
    variant = "",
    background = "dark"
}
```

#### 1.3 Update Lazy.nvim to Use Dynamic Colorscheme

**File:** `/home/curator/.dotfiles/nvim/.config/nvim/lua/config/lazy.lua`

Replace lines 31-32 (current hardcoded colorscheme) with:

```lua
-- Load colorscheme from theme-switcher configuration
local ok, theme_config = pcall(require, "config.colorscheme")
if ok and theme_config and theme_config.colorscheme then
    -- Set variant-specific global variables if needed
    if theme_config.variant ~= "" then
        if theme_config.colorscheme == "everforest" then
            vim.g.everforest_background = theme_config.variant
        elseif theme_config.colorscheme == "neon" then
            vim.g.neon_style = theme_config.variant
        elseif theme_config.colorscheme:match("^catppuccin") then
            vim.g.catppuccin_flavour = theme_config.variant
        end
    end

    -- Set background
    vim.opt.background = theme_config.background

    -- Apply colorscheme
    vim.cmd.colorscheme(theme_config.colorscheme)

    -- Apply transparency overrides
    vim.api.nvim_set_hl(0, "Normal", { bg = "none" })
    vim.api.nvim_set_hl(0, "NormalFloat", { bg = "none" })
    vim.api.nvim_set_hl(0, "FloatBorder", { bg = "none" })
    vim.api.nvim_set_hl(0, "NeoTreeNormal", { bg = "none" })
    vim.api.nvim_set_hl(0, "NeoTreeNormalNC", { bg = "none" })
else
    -- Fallback to catppuccin
    vim.cmd.colorscheme("catppuccin-frappe")

    vim.api.nvim_set_hl(0, "Normal", { bg = "none" })
    vim.api.nvim_set_hl(0, "NormalFloat", { bg = "none" })
    vim.api.nvim_set_hl(0, "FloatBorder", { bg = "none" })
    vim.api.nvim_set_hl(0, "NeoTreeNormal", { bg = "none" })
    vim.api.nvim_set_hl(0, "NeoTreeNormalNC", { bg = "none" })
end
```

#### 1.4 Delete Old Catppuccin Plugin File

Remove `/home/curator/.dotfiles/nvim/.config/nvim/lua/plugins/catppuccin.lua` (now integrated into colorschemes.lua)

#### 1.5 Install Plugins

Open Neovim and run `:Lazy sync` to install all colorscheme plugins. Test each one manually:
- `:colorscheme everforest`
- `:colorscheme ashen`
- `:colorscheme iceberg`
- `:colorscheme nord`
- `:colorscheme neon`
- `:colorscheme catppuccin-latte`
- `:colorscheme lavender`
- `:colorscheme lackluster`

### Phase 2: Extract Color Palettes

For each theme, extract the color palette from the GitHub repository or running theme.

#### 2.1 Create Palette Extraction Script (Optional Helper)

**File:** `/home/curator/.dotfiles/bin/.bin/extract-nvim-colors.lua`

```lua
#!/usr/bin/env -S nvim -l

-- Usage: nvim -l extract-nvim-colors.lua <colorscheme-name>
-- Outputs JSON palette to stdout

local colorscheme = arg[1]
if not colorscheme then
    print("Usage: nvim -l extract-nvim-colors.lua <colorscheme-name>")
    os.exit(1)
end

-- Minimal init
vim.opt.termguicolors = true

-- Try to load the colorscheme
local ok = pcall(vim.cmd.colorscheme, colorscheme)
if not ok then
    print("Error: Could not load colorscheme '" .. colorscheme .. "'")
    os.exit(1)
end

-- Helper to convert highlight to hex
local function hl_to_hex(hl_group)
    local hl = vim.api.nvim_get_hl(0, { name = hl_group, link = false })
    return hl
end

-- Extract colors
local normal = hl_to_hex("Normal")
local cursor = hl_to_hex("Cursor")
local visual = hl_to_hex("Visual")

-- Terminal colors
local terminal_colors = {}
for i = 0, 15 do
    local var = "terminal_color_" .. i
    if vim.g[var] then
        terminal_colors[tostring(i)] = vim.g[var]
    end
end

-- Build palette JSON
local palette = {
    background = string.format("#%06x", normal.bg or 0x000000),
    foreground = string.format("#%06x", normal.fg or 0xffffff),
    cursor = string.format("#%06x", cursor.bg or normal.fg or 0xffffff),
    cursor_text = string.format("#%06x", cursor.fg or normal.bg or 0x000000),
    selection_bg = string.format("#%06x", visual.bg or 0x444444),
    selection_fg = string.format("#%06x", visual.fg or normal.fg or 0xffffff),
    terminal_colors = terminal_colors
}

-- Output JSON
print(vim.json.encode(palette))
```

Make executable: `chmod +x /home/curator/.dotfiles/bin/.bin/extract-nvim-colors.lua`

#### 2.2 Extract Palettes for Each Theme

For each theme, visit the GitHub repository and locate the palette definition:

**Theme Repositories:**
1. **everforest** - https://github.com/sainnhe/everforest (check `autoload/everforest.vim`)
2. **ashen** - https://github.com/ficcdaf/ashen.nvim (check `lua/ashen/palette.lua`)
3. **iceberg** - https://github.com/cocopon/iceberg.vim (check `colors/iceberg.vim`)
4. **nord** - https://github.com/shaunsingh/nord.nvim (check `lua/nord/colors.lua`)
5. **neon** - https://github.com/rafamadriz/neon (check `lua/neon/colors.lua`)
6. **catppuccin** - Already available at `~/.local/share/nvim/lazy/catppuccin/lua/catppuccin/palettes/latte.lua`
7. **lavender** - https://github.com/joshuadanpeterson/lavender.nvim
8. **lackluster** - https://github.com/slugbyte/lackluster.nvim (check `lua/lackluster/color.lua`)

Optionally use the extraction script: `nvim -l extract-nvim-colors.lua <theme-name>`

#### 2.3 Update theme.json Files

For each theme directory in `/home/curator/.dotfiles/themes/<theme-name>/`, update `theme.json` with:

**New Structure:**
```json
{
  "name": "Theme Display Name",
  "slug": "theme-slug",
  "icon": "ðŸŽ¨",

  "nvim": {
    "colorscheme": "everforest",
    "variant": "hard",
    "background": "dark"
  },

  "palette": {
    "background": "#1e2326",
    "foreground": "#d3c6aa",
    "cursor": "#d3c6aa",
    "cursor_text": "#1e2326",
    "selection_bg": "#3d484d",
    "selection_fg": "#d3c6aa",

    "colors": {
      "black": "#374247",
      "red": "#e67e80",
      "green": "#a7c080",
      "yellow": "#dbbc7f",
      "blue": "#7fbbb3",
      "magenta": "#d699b6",
      "cyan": "#83c092",
      "white": "#d3c6aa",

      "bright_black": "#4f585e",
      "bright_red": "#f85552",
      "bright_green": "#8da101",
      "bright_yellow": "#dfa000",
      "bright_blue": "#3a94c5",
      "bright_magenta": "#df69ba",
      "bright_cyan": "#35a77c",
      "bright_white": "#dfddc8"
    }
  },

  "wallpapers": {
    "static": ["~/pictures/wallpapers/static/theme-bg.jpg"]
  },

  "monitors": {
    "DP-3": "static[0]",
    "DP-2": "static[0]",
    "DP-1": "static[0]"
  },

  "rofi_theme": "theme-slug"
}
```

**Mapping nvim colorscheme names:**
- Dark Green (Everforest) â†’ `"colorscheme": "everforest"`, `"variant": "hard"`, `"background": "dark"`
- Reddish/Orange (Ashen) â†’ `"colorscheme": "ashen"`, `"variant": ""`, `"background": "dark"`
- Blue/Azure (Iceberg) â†’ `"colorscheme": "iceberg"`, `"variant": ""`, `"background": "dark"`
- Blue/Azure (Nord) â†’ `"colorscheme": "nord"`, `"variant": ""`, `"background": "dark"`
- Cyberpunk (Neon) â†’ `"colorscheme": "neon"`, `"variant": "dark"`, `"background": "dark"`
- Soft Light (Catppuccin Latte) â†’ `"colorscheme": "catppuccin-latte"`, `"variant": "latte"`, `"background": "light"`
- Purple (Lavender) â†’ `"colorscheme": "lavender"`, `"variant": ""`, `"background": "dark"`
- Grey (Lackluster) â†’ `"colorscheme": "lackluster"`, `"variant": ""`, `"background": "dark"`

### Phase 3: Update Theme Switcher Script

#### 3.1 Add Neovim Colorscheme Switching Function

**File:** `/home/curator/.dotfiles/bin/.bin/theme-switcher.sh`

Add this function after line 82 (after the `apply_theme` function ends):

```bash
# Function to switch Neovim colorscheme
switch_nvim_colorscheme() {
    THEME_DIR="$1"

    if [ ! -f "$THEME_DIR/theme.json" ]; then
        echo "  ! Warning: theme.json not found, skipping nvim colorscheme update"
        return
    fi

    # Extract nvim colorscheme from theme.json
    NVIM_COLORSCHEME=$(jq -r '.nvim.colorscheme // empty' "$THEME_DIR/theme.json")
    NVIM_VARIANT=$(jq -r '.nvim.variant // ""' "$THEME_DIR/theme.json")
    NVIM_BACKGROUND=$(jq -r '.nvim.background // "dark"' "$THEME_DIR/theme.json")

    if [ -z "$NVIM_COLORSCHEME" ]; then
        echo "  ! Warning: No nvim colorscheme defined in theme.json"
        return
    fi

    # Update colorscheme config file
    COLORSCHEME_FILE="$HOME/.dotfiles/nvim/.config/nvim/lua/config/colorscheme.lua"
    cat > "$COLORSCHEME_FILE" << EOF
-- Auto-generated by theme-switcher.sh
-- DO NOT EDIT MANUALLY - changes will be overwritten
return {
    colorscheme = "$NVIM_COLORSCHEME",
    variant = "$NVIM_VARIANT",
    background = "$NVIM_BACKGROUND"
}
EOF

    echo "  âœ“ Updated Neovim colorscheme config"
}
```

#### 3.2 Integrate Function Into apply_theme

In the `apply_theme()` function, add the call to `switch_nvim_colorscheme` after line 63 (after Starship update):

```bash
    # 6.5. Update Starship prompt
    if [ -f "$THEME_DIR/starship.toml" ]; then
        cp "$THEME_DIR/starship.toml" "$DOTFILES/starship/.config/starship.toml"
        echo "  âœ“ Updated Starship prompt"
    fi

    # 6.6. Switch Neovim colorscheme
    switch_nvim_colorscheme "$THEME_DIR"

    # 7. Update Hyprpaper wallpapers
    update_wallpapers "$THEME_DIR"
```

### Phase 4: Create Application Configs (User Manual Work)

For each theme in `/home/curator/.dotfiles/themes/<theme-name>/`, you will manually create or update these config files using the color palette from `theme.json`:

**Required Files Per Theme:**
- `kitty.conf` - Terminal colors
- `waybar.css` - Status bar styling
- `mako.conf` - Notification colors
- `starship.toml` - Shell prompt
- `hyprland.conf` - Window manager colors
- `hyprlock.conf` - Lock screen
- Rofi theme file in `/home/curator/.dotfiles/rofi/.config/rofi/<theme-slug>.rasi`

**Reference:** Use existing themes as templates, replacing hex color values with those from the extracted palette.

### Phase 5: Testing & Verification

#### 5.1 Test Neovim Colorscheme Loading

1. Open Neovim and verify current colorscheme loads
2. Manually test each colorscheme: `:colorscheme <name>`
3. Verify transparency works for each theme
4. Restart Neovim and verify colorscheme persists

#### 5.2 Test Theme Switching

For each theme:
1. Run: `~/.dotfiles/bin/.bin/theme-switcher.sh apply <theme-name>`
2. Verify colorscheme.lua is updated with correct values
3. Open new Neovim instance and verify correct theme loads
4. Check all other components (kitty, waybar, etc.) are updated

#### 5.3 Test Waybar Integration

1. Click waybar theme button
2. Select theme from rofi menu
3. Verify all components switch correctly
4. Open Neovim and verify correct colorscheme

#### 5.4 Edge Cases

Test these scenarios:
- Switch theme with no Neovim instances running
- Switch theme with multiple Neovim instances open (they'll update on restart)
- Missing nvim section in theme.json (should warn and continue)
- Invalid colorscheme name (Neovim will error on next launch)

## Critical Files to Modify

1. **`/home/curator/.dotfiles/nvim/.config/nvim/lua/plugins/colorschemes.lua`** (create new)
2. **`/home/curator/.dotfiles/nvim/.config/nvim/lua/config/colorscheme.lua`** (create new)
3. **`/home/curator/.dotfiles/nvim/.config/nvim/lua/config/lazy.lua`** (modify colorscheme loading)
4. **`/home/curator/.dotfiles/bin/.bin/theme-switcher.sh`** (add nvim switching function)
5. **`/home/curator/.dotfiles/themes/*/theme.json`** (update all with nvim config and palette)

Delete:
- **`/home/curator/.dotfiles/nvim/.config/nvim/lua/plugins/catppuccin.lua`** (replaced by colorschemes.lua)

## Verification

After implementation:

1. **Neovim works:** Open nvim, verify colorscheme loads correctly
2. **Manual switching works:** `:colorscheme <name>` changes theme instantly
3. **Theme switcher works:** Run script, nvim config updates, next nvim instance uses new theme
4. **Waybar button works:** Click button, select theme, all components update
5. **Persistence works:** Colorscheme persists across nvim restarts
6. **Fallback works:** If theme.json missing nvim section, system continues without error

## Notes

- Neovim colorscheme changes take effect on next Neovim launch (not live reload)
- User must manually create kitty/waybar/mako/etc configs for each theme
- Color palettes stored in theme.json for reference
- Theme switcher handles both system configs and Neovim colorscheme atomically
- All colorscheme plugins installed via lazy.nvim, always available
